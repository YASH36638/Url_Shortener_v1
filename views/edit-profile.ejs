<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Edit Profile</title>
  <link rel="stylesheet" href="/index.css" />
</head>
<body>

  <div class="page-container">
    <div class="card profile-card">
      <h2 class="card-title">Edit Profile</h2>
      <form method="POST" action="/edit-profile" class="form" enctype="multipart/form-data">

        <div class="avatar-upload">

  <div class="profile-avatar">
    <% if (avatarUrl) { %>
      <img
        src="<%= avatarUrl %>"
        alt="Profile picture"
        id="avatar-preview-img"
      >
    <% } else { %>
      <div class="profile-avatar" id="avatar-placeholder">
        Profile
      </div>
      <img
        src=""
        alt="Preview"
        id="avatar-preview-img"
        style="display: none;"
      >
    <% } %>
  </div>

  <div class="avatar-edit">
    <label for="avatar" class="avatar-upload-btn">
      Change Photo
    </label>

    <input
      type="file"
      id="avatar"
      name="avatar"
      accept="image/*"
      class="avatar-input"
    />

    <% if (avatarUrl) { %>
      <button
        type="button"
        id="remove-avatar"
        class="remove-avatar-btn"
      >
        Remove
      </button>
    <% } %>
  </div>

</div>
        <div class="form-group">
          <label for="name">Name</label>
          <input
            type="text"
            id="name"
            name="name"
            value="<%= name %>"
            required
          />
        </div>


        <button type="submit" class="btn primary-btn">
          Save Changes
        </button>
      </form>

     
    </div>
  </div>
 <script>
           //  Preview uploaded image
       document.getElementById('avatar').addEventListener('change', function(e) {
         const file = e.target.files[0];
         console.log("file ", e);
         
         if (file) {
           const reader = new FileReader();
           reader.onload = function(event) {
             const avatarPreviewImg = document.getElementById('avatar-preview-img');
             avatarPreviewImg.src = event.target.result; // Contains the file's data as a base64 string.
             avatarPreviewImg.style.display = 'block';
             
             const placeholder = document.getElementById('avatar-placeholder');
             if (placeholder) {
               placeholder.style.display = 'none';
             }
           }
           reader.readAsDataURL(file); // file = input.files[0]
         }
       });

           // Handle remove avatar button if it exists
       const removeAvatarBtn = document.getElementById('remove-avatar');
       if (removeAvatarBtn) {
         removeAvatarBtn.addEventListener('click', function() {
           // Add a hidden input to indicate avatar removal
           const hiddenInput = document.createElement('input');
           hiddenInput.type = 'hidden';
           hiddenInput.name = 'removeAvatar';
           hiddenInput.value = 'true';
           document.querySelector('form').appendChild(hiddenInput);
           
           // Update UI
           document.getElementById('avatar-preview-img').style.display = 'none';
           
           // Create placeholder if it doesn't exist
           let placeholder = document.getElementById('avatar-placeholder');
           if (!placeholder) {
             placeholder = document.createElement('div');
             placeholder.id = 'avatar-placeholder';
             placeholder.className = 'profile-avatar';
             placeholder.textContent = 'Profile';
             document.querySelector('.profile-avatar').appendChild(placeholder);
           }
           placeholder.style.display = 'flex';
           
           // Reset file input
           document.getElementById('avatar').value = '';
         });
       }
   
       </script>

</body>
</html>